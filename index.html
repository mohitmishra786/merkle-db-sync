<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merkle Tree Database Replication Visualizer</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Merkle Tree Database Replication Visualizer</h1>
            <p>
                This interactive demo shows how Merkle trees enable efficient database synchronization by comparing hash trees 
                instead of transferring entire datasets. Only changed data blocks are synced, dramatically reducing bandwidth usage.
            </p>
        </div>

        <!-- Tutorial Section -->
        <div class="tutorial">
            <div class="tutorial-header">
                <h3>How to Use This Visualizer</h3>
                <button class="tutorial-toggle" id="tutorial-toggle">Show/Hide</button>
            </div>
            <div class="tutorial-content" id="tutorial-content">
                <div class="tutorial-steps">
                    <div class="step">
                        <span class="step-number">1</span>
                        <span class="step-text">Click "Generate Sample Data" to create test data in both databases</span>
                    </div>
                    <div class="step">
                        <span class="step-number">2</span>
                        <span class="step-text">Click "Create Differences" to simulate changes in the source database</span>
                    </div>
                    <div class="step">
                        <span class="step-number">3</span>
                        <span class="step-text">Click "Build Trees" to generate Merkle trees for both databases</span>
                    </div>
                    <div class="step">
                        <span class="step-number">4</span>
                        <span class="step-text">Click "Compare Roots" to check if databases are in sync</span>
                    </div>
                    <div class="step">
                        <span class="step-number">5</span>
                        <span class="step-text">Click "Drill Down" to find specific differences</span>
                    </div>
                    <div class="step">
                        <span class="step-number">6</span>
                        <span class="step-text">Click "Identify Changes" to see what needs to be synced</span>
                    </div>
                    <div class="step">
                        <span class="step-number">7</span>
                        <span class="step-text">Click "Sync Changes" to efficiently update the replica</span>
                    </div>
                </div>
                <div class="tutorial-tip">
                    <strong>Tip:</strong> You can also manually edit data using the input fields or add/remove rows using the + and Ã— buttons.
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="data-section">
                <div class="data-container">
                    <h3>
                        Source Database
                        <button class="add-row-btn" id="add-source-row" title="Add new row">+</button>
                    </h3>
                    <table class="data-table" id="source-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Value</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="source-tbody"></tbody>
                    </table>
                </div>
                <div class="data-container">
                    <h3>
                        Replica Database
                        <button class="add-row-btn" id="add-replica-row" title="Add new row">+</button>
                    </h3>
                    <table class="data-table" id="replica-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Value</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="replica-tbody"></tbody>
                    </table>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="generate-data">Generate Sample Data</button>
                <button class="btn btn-warning" id="create-differences">Create Differences</button>
                <button class="btn btn-success" id="build-trees">Build Merkle Trees</button>
                <button class="btn btn-warning" id="compare-roots">Compare Roots</button>
                <button class="btn btn-warning" id="drill-down" disabled>Drill Down</button>
                <button class="btn btn-warning" id="identify-changes" disabled>Identify Changes</button>
                <button class="btn btn-success" id="sync-changes" disabled>Sync Changes</button>
                <button class="btn btn-danger" id="reset">Reset</button>
            </div>
        </div>

        <div class="visualization">
            <div class="tree-row">
                <div class="tree-container">
                    <div class="tree-header">
                        <h3>Source Merkle Tree</h3>
                        <div class="zoom-controls">
                            <button class="zoom-btn" id="source-zoom-in">+</button>
                            <button class="zoom-btn" id="source-zoom-out">-</button>
                            <button class="zoom-btn" id="source-reset-zoom">Reset</button>
                        </div>
                    </div>
                    <div class="tree-svg-container">
                        <svg class="tree-svg" id="source-tree"></svg>
                    </div>
                    <div class="stats" id="source-stats">
                        <h4>Source Statistics</h4>
                        <p>Nodes: <span id="source-nodes">0</span></p>
                        <p>Height: <span id="source-height">0</span></p>
                        <p>Root Hash: <span id="source-root-hash">-</span></p>
                    </div>
                </div>
                <div class="tree-container">
                    <div class="tree-header">
                        <h3>Replica Merkle Tree</h3>
                        <div class="zoom-controls">
                            <button class="zoom-btn" id="replica-zoom-in">+</button>
                            <button class="zoom-btn" id="replica-zoom-out">-</button>
                            <button class="zoom-btn" id="replica-reset-zoom">Reset</button>
                        </div>
                    </div>
                    <div class="tree-svg-container">
                        <svg class="tree-svg" id="replica-tree"></svg>
                    </div>
                    <div class="stats" id="replica-stats">
                        <h4>Replica Statistics</h4>
                        <p>Nodes: <span id="replica-nodes">0</span></p>
                        <p>Height: <span id="replica-height">0</span></p>
                        <p>Root Hash: <span id="replica-root-hash">-</span></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="log-section">
            <h3>Operation Log</h3>
            <div class="log-container" id="log-container"></div>
        </div>
    </div>

    <div class="tooltip" id="tooltip" style="display: none;"></div>

    <script src="app.js"></script>
    
    <!-- GoatCounter Analytics -->
    <script data-goatcounter="https://merkle-db-sync.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>
</body>
</html> 